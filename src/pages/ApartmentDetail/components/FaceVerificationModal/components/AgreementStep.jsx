import { Button, Typography, Divider } from "antd";
import { FileProtectOutlined } from "@ant-design/icons";
const { Title, Paragraph } = Typography;
import pdfMake from "pdfmake/build/pdfmake";
import * as pdfFonts from "pdfmake/build/vfs_fonts";

pdfMake.vfs = pdfFonts.default.vfs;

const handleDownloadTemplate = () => {
  const docDefinition = {
    content: [
      {
        text: "ДОГОВОР ПОСУТОЧНОГО НАЙМА КВАРТИРЫ",
        style: "header",
        alignment: "center",
        margin: [0, 0, 0, 20],
      },
      { text: "г. _________________________", alignment: "right" },
      {
        text: "«_____»___________________ 20__ г.",
        alignment: "right",
        margin: [0, 0, 0, 20],
      },

      {
        text: `Мы, нижеподписавшиеся, гражданин ______________________, проживающий по адресу: ____________________________,\nпаспорт серии ______ № ________, выдан «___»___________ ______ г., именуемый в дальнейшем «Наймодатель», с одной стороны, и гражданин _________________________,\nпроживающий по адресу: ____________________________________, паспорт серии _________ № ________, выдан «___» ___________ _______ г., именуемый в дальнейшем «Наниматель», с другой стороны, заключили настоящий Договор о нижеследующем:\n`,
        margin: [0, 0, 0, 15],
      },

      { text: "1. ПРЕДМЕТ ДОГОВОРА", style: "section" },
      {
        text: "1.1. Наймодатель передает, а Наниматель принимает во временное платное пользование ___-комнатную квартиру по адресу: город _______________________, улица ____________________, дом _________, строение _______, квартира ______.",
      },
      {
        text: "1.2. Квартира передается в аренду сроком на ______ суток, с ___:___ «___»___________ 20__ г. по ___:___ «___»___________ 20__ г.",
      },
      {
        text: "1.3. Право собственности подтверждено документами: _______________________________________________.",
      },
      {
        text: "1.4. В квартире находятся вещи, перечисленные в акте приёма-сдачи.",
      },

      { text: "2. АРЕНДНАЯ ПЛАТА И КОММУНАЛЬНЫЕ УСЛУГИ", style: "section" },
      {
        ul: [
          "Арендная плата: __________ (______________________________) рублей, из расчета _______ руб/сутки.",
          "Оплата: наличными / безналично при подписании договора.",
          "Депозит (при наличии): ________, возвращается при выезде и целостности имущества.",
          "В арендную плату включены коммунальные услуги (кроме: ____________________________).",
          "Проживание сверх срока — доплата по суточной ставке.",
        ],
      },

      { text: "3. ОБЯЗАННОСТИ СТОРОН", style: "section" },
      {
        ul: [
          "Наймодатель предоставляет квартиру с мебелью, техникой, посудой.",
          "Наймодатель устраняет неисправности (если не по вине Нанимателя).",
          "Наниматель соблюдает правила проживания и не мешает соседям.",
          "Наниматель бережно относится к имуществу.",
          "Наниматель сообщает о поломках, возвращает ключи и квартиру в порядке.",
        ],
      },

      { text: "4. ПРОЖИВАНИЕ ДРУГИХ ЛИЦ", style: "section" },
      {
        ol: [
          "_______________________, паспорт: ___________________________",
          "_______________________, паспорт: ___________________________",
        ],
      },

      { text: "5. ПОРЯДОК ПЕРЕДАЧИ И ВОЗВРАТА КВАРТИРЫ", style: "section" },
      {
        ul: [
          "Передача и возврат оформляются актами приёма-сдачи.",
          "Осмотр и фиксация дефектов — при заселении.",
          "Ключи возвращаются при выезде.",
        ],
      },

      { text: "6. ОТВЕТСТВЕННОСТЬ СТОРОН", style: "section" },
      {
        ul: [
          "За ущерб — возмещение убытков.",
          "За порчу/утрату имущества — ответственность Нанимателя.",
          "Споры решаются переговорами или в суде.",
        ],
      },

      { text: "7. ПРОЧИЕ УСЛОВИЯ", style: "section" },
      {
        ul: [
          "Договор вступает в силу с момента подписания.",
          "Продление — по дополнительному соглашению.",
          "Договор составлен в двух экземплярах.",
          "Приложение — акт приёма-сдачи.",
        ],
      },

      { text: "Подписи сторон:\n\n", margin: [0, 20, 0, 5] },

      {
        columns: [
          {
            width: "50%",
            text: [
              { text: "Наймодатель:\n", bold: true },
              "ФИО: _______________________________\n",
              "Подпись: ___________________________",
            ],
          },
          {
            width: "50%",
            text: [
              { text: "Наниматель:\n", bold: true },
              "ФИО: _______________________________\n",
              "ИИН: _______________________________\n",
              "Телефон: ___________________________\n",
              "Подпись: ___________________________",
            ],
          },
        ],
      },
    ],
    styles: {
      header: { fontSize: 16, bold: true },
      section: { fontSize: 13, bold: true, margin: [0, 10, 0, 3] },
    },
    defaultStyle: {
      font: "Roboto",
      fontSize: 11,
    },
  };

  pdfMake.createPdf(docDefinition).download("Шаблон_договора.pdf");
};

const AgreementStep = ({
  onNext,
  onBack,
  clientData,
  checkInDate,
  checkOutDate,
  nights,
  pricePerNight,
}) => {
  const total = nights * pricePerNight;

  return (
    <div>
      <Title level={4}>Договор аренды</Title>
      <Paragraph>
        Я, <strong>{`${clientData.lastName} ${clientData.firstName}`}</strong>,
        ИИН <strong>{clientData.iin}</strong>, телефон{" "}
        <strong>{clientData.phone}</strong>, подтверждаю, что ознакомлен с
        условиями аренды и согласен с ними.
      </Paragraph>
      <Paragraph>
        Квартира бронируется с <strong>{checkInDate}</strong> по{" "}
        <strong>{checkOutDate}</strong> (всего <strong>{nights} ночи</strong>).
        <br />
        Заезд: <strong>после 14:00</strong>, выезд: <strong>до 12:00</strong>.
      </Paragraph>
      <Paragraph>
        Стоимость аренды:{" "}
        <strong>₸{pricePerNight.toLocaleString()} / ночь</strong>. Общая сумма:{" "}
        <strong>₸{total.toLocaleString()}</strong>.
      </Paragraph>
      <Button
        icon={<FileProtectOutlined />}
        onClick={handleDownloadTemplate}
        type="primary"
      >
        Скачать шаблон договора
      </Button>
      <Divider />
      <div style={{ marginTop: 24, display: "flex", gap: 8 }}>
        <Button onClick={onBack}>Назад</Button>
        <Button type="primary" onClick={onNext} block>
          Подписать договор и продолжить
        </Button>
      </div>
    </div>
  );
};

export default AgreementStep;
